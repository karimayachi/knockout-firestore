!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("knockout")):"function"==typeof define&&define.amd?define(["knockout"],t):"object"==typeof exports?exports.kofs=t(require("knockout")):e.kofs=t(e.ko)}(window,function(e){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(t,o){t.exports=e},function(e,t,o){"use strict";o.r(t);var n=o(0);function r(e,t){var o=e;!function e(t,o){var n=Object.getPrototypeOf(t);n===o||(n===Object.prototype||n===Function.prototype?Object.setPrototypeOf(t,o):e(n,o))}(e,Object.getPrototypeOf(t));for(var n=0,r=Object.getOwnPropertyNames(t);n<r.length;n++){var i=r[n],s=Object.getOwnPropertyDescriptor(t,i);!s||s.writable&&s.configurable&&s.enumerable&&!s.get&&!s.set?e[i]=t[i]:Object.defineProperty(e,i,s)}return o}var i=function(){return function(e){var t=this;this.debug=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];2==t.logLevel&&(e.unshift("[KOFS]"),console.debug.apply(console,e))},this.error=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];t.logLevel>0&&(e.unshift("[KOFS]"),console.error.apply(console,e))},this.logLevel=e||0}}(),s=function(){function e(e){var t=this;this.lock=!1,this.twoWayBinding=!0,this.state=n.observable(0),this.modified=n.pureComputed(function(){return 0!=t.state()}),this.logger=e||new i,Object.defineProperty(this,"state",{enumerable:!1,configurable:!1,writable:!1}),Object.defineProperty(this,"modified",{enumerable:!1,configurable:!1,writable:!1})}return e.prototype.getFlatDocument=function(){for(var e={},t=0,o=Object.keys(this);t<o.length;t++){var r=o[t];if(this.hasOwnProperty(r)){var i=this[r];if(n.isObservable(i)&&!n.isComputed(i)&&!this.includes[r]){var s=void 0;s="boolean"==typeof i()||"number"==typeof i()?i():i()||"",e[r]=s}}}return e},e.prototype.save=function(){var e=this;if(0!=this.state())if(void 0!==this.fsBaseCollection){var t=this.getFlatDocument();1==this.state()?this.fsBaseCollection.add(t).then(function(t){e.logger.debug("Firestore document "+t.id+" added to database"),e.fsDocumentId=t.id,2==e.state()?(e.logger.debug("Firestore document "+t.id+" was modified during insert, save changes"),e.save()):e.state(0)}).catch(function(t){e.logger.error("Error adding Firestore document :",t)}):2==this.state()?this.fsBaseCollection.doc(this.fsDocumentId).update(t).then(function(){e.logger.debug("Firestore document "+e.fsDocumentId+" saved to database"),e.state(0)}).catch(function(t){e.logger.error("Error saving Firestore document :",t)}):3==this.state()&&this.fsBaseCollection.doc(this.fsDocumentId).delete().then(function(){e.logger.debug("Firestore document "+e.fsDocumentId+" deleted from database")}).catch(function(t){e.logger.error("Error saving Firestore document :",t)})}else this.logger.error("Firestore document "+this.fsDocumentId+" not part of a Collection");else this.logger.debug("Firestore document "+this.fsDocumentId+" unchanged")},e.prototype.saveProperty=function(e,t){var o=this,n={};"number"==typeof t||"string"==typeof t||"boolean"==typeof t?n[e]=t:Array.isArray(t)&&(n[e]=t.filter(function(e){return"number"==typeof e||"string"==typeof e||"boolean"==typeof e})),void 0!==this.fsBaseCollection?void 0===this.fsDocumentId?this.state(2):this.fsBaseCollection.doc(this.fsDocumentId).update(n).then(function(){o.logger.debug("Firestore document "+o.fsDocumentId+" saved to database")}).catch(function(e){o.logger.error("Error saving Firestore document :",e)}):this.logger.error("Firestore document "+this.fsDocumentId+" not part of a Collection")},e}();function c(e,t,o){var i=r(e,new s(o));i.includes=Object.assign(t||{},i.includes);for(var c=function(e){if(!i.hasOwnProperty(e))return"continue";var t,o=i[e];!n.isObservable(o)||n.isObservableArray(o)&&i.includes[e]||n.isComputed(o)||(t=e,o.subscribe(function(e){i.logger.debug('Knockout observable property "'+t+'" changed. LocalOnly: '+i.lock),i.lock||(i.twoWayBinding?i.saveProperty(t,e):1!=i.state()&&i.state(2))}))},l=0,a=Object.keys(i);l<a.length;l++){c(a[l])}return i}var l=function(){function e(e){this.localOnly=!1,this.twoWayBinding=!1,this.logger=e||new i}return e.prototype.getDocument=function(e){for(var t=0,o=this();t<o.length;t++){var n=o[t];if(n.fsDocumentId===e)return n}return null},e.prototype.detach=function(e){this.twoWayBinding?this.remove(e):(e.state(3),this.destroy(e),this.logger.debug('Document "'+e.fsDocumentId+'" detached from local collection.'))},e.prototype.saveAll=function(){for(var e=0,t=this();e<t.length;e++){var o=t[e];0!==o.state()&&o.save()}},e}();function a(e){var t=this;if(!this.localOnly&&void 0!==this.fsCollection)for(var o=function(e){var o=e.value;switch(e.status){case"added":var i=c(o,r.includes,r.logger);i.twoWayBinding=r.twoWayBinding,r.twoWayBinding?(r.logger.debug('Adding new document to Firestore collection "'+r.fsCollection.id+'"'),r.fsCollection.add(i.getFlatDocument()).then(function(e){i.fsBaseCollection=e.parent,i.fsDocumentId=e.id,function(e){for(var t=0,o=Object.keys(e);t<o.length;t++){var r=o[t];if(e.hasOwnProperty(r)&&void 0!==e.fsBaseCollection){var i=e[r];if(n.isObservableArray(i)&&e.includes&&e.includes[r]){var s=e.includes[r],l=e.fsBaseCollection.doc(e.fsDocumentId).collection(r);u(i,l,s.class,{twoWayBinding:e.twoWayBinding,orderBy:s.orderBy,logLevel:e.logger.logLevel});for(var a=0,d=i();a<d.length;a++){var f=d[a],g=c(f,{},e.logger);g.fsBaseCollection=l,g.twoWayBinding=e.twoWayBinding,g.state(1),g.save()}}}}}(i)}).catch(function(e){t.logger.error("Error saving Firestore document :",e)})):(r.logger.debug("Adding new document to local collection only"),i.state(1),i.fsBaseCollection=r.fsCollection);break;case"deleted":if(r.twoWayBinding){r.logger.debug('Deleting document "'+o.fsDocumentId+'" from Firestore collection "'+r.fsCollection.id+'"');var s=o;if(void 0===s.fsBaseCollection)return"continue";s.fsBaseCollection.doc(s.fsDocumentId).delete().catch(function(e){t.logger.error("Error deleting Firestore document :",e)})}else r.logger.debug('Document "'+o.fsDocumentId+'" removed from local collection.'),r.logger.debug("You're not using Two-Way binding, please use .detach() in stead of .remove() to persist the change when syncing to Firestore")}},r=this,i=0,s=e;i<s.length;i++){o(s[i])}}function d(e,t,o){var r=n.observableArray();return u(r,e,t,o),r}function u(e,t,o,n){var s=(n=n||{}).where||[],d=n.orderBy||[],u=n.includes||{},g=void 0===n.twoWayBinding||n.twoWayBinding,y=function(e,t,o){var n=e;if(null!=t&&Array.isArray(t)&&t.length>0)if(Array.isArray(t[0]))for(var r=0,i=t;r<i.length;r++){var s=i[r];n=n.where(s[0],s[1],s[2])}else n=n.where(t[0],t[1],t[2]);if(null!=o&&Array.isArray(o)&&o.length>0)if(Array.isArray(o[0]))for(var c=0,l=o;c<l.length;c++){var a=l[c];n=n.orderBy(a[0],a[1])}else n=n.orderBy(o[0],o[1]);return n}(t,s,d),b=new i(n.logLevel),v=function(e,t){var o,n=new l(t);return e.fsQuery?((o=e).localOnly=!0,o.removeAll(),o.localOnly=!1):(o=r(e,n)).subscribe(a,o,"arrayChange"),o}(e,b);v.twoWayBinding=g,v.fsQuery=y,v.fsCollection=t,v.includes=u,y.onSnapshot(function(e){e.docChanges().forEach(function(e){if(!e.doc.metadata.hasPendingWrites){if("added"===e.type){b.debug("Firestore object "+e.doc.id+" added to collection");var t=new o,n=e.newIndex,r=c(t,Object.assign(u,t.includes),b);r.fsBaseCollection=e.doc.ref.parent,r.fsDocumentId=e.doc.id,r.twoWayBinding=g,f(e.doc,r,g),v.localOnly=!0,v.splice(n,0,r),v.localOnly=!1}var i;if("modified"===e.type)b.debug("Firestore object "+e.doc.id+" modified"),null!=(i=v.getDocument(e.doc.id))?f(e.doc,i,!1):b.debug("Firestore object "+e.doc.id+" not found in local collection");if("removed"===e.type)b.debug("Firestore object "+e.doc.id+" removed from collection"),null!=(i=v.getDocument(e.doc.id))?(v.localOnly=!0,v.remove(i),v.localOnly=!1):b.debug("Firestore object "+e.doc.id+" not (longer) found in local collection")}})})}function f(e,t,o){t.lock=!0;for(var r=0,i=Object.keys(t);r<i.length;r++){var s=i[r];if(t.hasOwnProperty(s)){var c=void 0,l=t[s];if(n.isObservable(l)&&!n.isObservableArray(l)&&!n.isComputed(l))switch(typeof(c=e.get(s))){case"undefined":break;case"string":case"number":case"boolean":l(c);break;case"object":c&&"function"==typeof c.toDate&&l(c.toDate())}if(n.isObservableArray(l)&&!t.includes[s]&&(c=e.get(s),Array.isArray(c)&&l(c)),o&&n.isObservableArray(l)&&t.includes[s]&&void 0!==t.fsBaseCollection){var a=t.includes[s];u(l,t.fsBaseCollection.doc(t.fsDocumentId).collection(s),a.class,{twoWayBinding:t.twoWayBinding,orderBy:a.orderBy,logLevel:t.logger.logLevel})}}}t.lock=!1}o.d(t,"getBoundCollection",function(){return d}),o.d(t,"bindCollection",function(){return u})}])});
//# sourceMappingURL=knockout.firestore.min.js.map